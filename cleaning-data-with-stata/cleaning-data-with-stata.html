<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Andy Grogan-Kaylor" />
  <title>Cleaning Data With Stata</title>
  <style type="text/css">code{white-space: pre;}</style>
<style>
/* CSS for Markstat 2.0 using Pandoc 2.0 */
body{padding:14px 28px; max-width:45em;}
body, table {font-family: Helvetica, Arial, Sans-serif; font-size: 14px;}
h1, h2, h3, h4 {font-weight: normal; color: #3366cc}
h1 {font-size: 200%;}
h2 {font-size: 150%;}
h3 {font-size: 120%;}
h4 {font-size: 100%; font-weight:bold}
img.center {display:block; margin-left:auto; margin-right:auto}
.small{font-size:8pt;}
a {color: black;}
a:visited {color: #808080;}
a.plain {text-decoration:none;}
a.plain:hover {text-decoration:underline;}
.em {font-weight:bold;}
pre, code {font-family: "lucida console", monospace;}
pre.stata {font-size:13px; line-height:13px;}
pre {padding:8px; border:1px solid #c0c0c0; border-radius:8px; background-color:#fdfdfd;}
code {color:#3366cc; background-color:#fafafa;}
pre code { color:black; background-color:white}
/* Added for Pandoc */
figure > img, div.figure > img {display:block; margin:auto}
figcaption, p.caption {text-align:center; font-weight:bold; color:#3366cc;}
h1.title {text-align:center; margin-bottom:0}
p.author, h2.author {font-style:italic; text-align:center;margin-top:4px;margin-bottom:0}
p.date, h3.date {text-align:center;margin-top:4px; margin-bottom:0}
/* Tables*/
table { margin:auto; border-collapse:collapse; }
table caption { margin-bottom:1ex;}
td {padding:0 0 0 0} /* override */
table:not([class]) th { padding:4px 6px } 
table:not([class]) td { padding:4px 6px } 
table:not([class]) thead tr:first-child th {border-top:1px solid black; padding-top:6px}
table:not([class]) thead tr:last-child  th {padding-bottom:6px}
table:not([class]) tbody tr:first-child td {border-top:1px solid black; padding-top:6px}
table:not([class]) tbody tr:last-child  td {padding-bottom:6px;}
table:not([class]) tbody:last-child tr:last-child td {border-bottom:1px solid black;}
</style>
</head>
<body>
<div id="header">
<h1 class="title">Cleaning Data With Stata</h1>
<h2 class="author">Andy Grogan-Kaylor</h2>
<h3 class="date">19 Feb 2022 11:36:27</h3>
</div>
<style>body {max-width: 90%;} h1 {color: #00274C;} h2 {color: #2F65A7;} blockquote {border-left: 5px solid #ffcb05; margin: 1.5em 10px; padding: 0.5em 10px;} code {color: red;}</style>
<h1 id="background">Background</h1>
<blockquote>
<p>It sometimes seems like 80% of our work as data analysts is cleaning the data, while only 20% is the actual analysis. Here are some Stata commands that are useful in cleaning data.</p>
</blockquote>
<p>First we simulate some data to work with, and to clean.</p>
<h1 id="simulate-some-data">Simulate Some Data</h1>
<blockquote>
<p>This section is provided for illustration only, as it may be helpful to see <em>how</em> the data was simulated, and the decisions that went into simulating the data. You may also <em>safely ignore</em> this section if you like.</p>
</blockquote>
<button type="button" class="collapsible">
Show / Hide Data Simulation Code
</button>
<div class="content">
<pre class='stata'>. clear all 
</pre>
<pre class='stata'>. set obs 100 // 100 observations
Number of observations (_N) was 0, now 100.
</pre>
<pre class='stata'>. generate id = _n // random id 
</pre>
<pre class='stata'>. generate age = rnormal(50,10) // random generated age
</pre>
<pre class='stata'>. replace age = 200 in 1 // someone is 200 years old!
(1 real change made)
</pre>
<pre class='stata'>. generate happy = runiformint(1,5) // randomly generated happiness
</pre>
<pre class='stata'>. replace happy = 999 in 10 // simulate a missing value
(1 real change made)
</pre>
<pre class='stata'>. generate somethingelse = rnormal(0, 1) // something else!
</pre>
</div>
<style>
.content {
  padding: 0 18px;
  display: none;
  overflow: hidden;
}
</style>
<script>    
var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
coll[i].addEventListener("click", function() {
this.classList.toggle("active");
var content = this.nextElementSibling;
if (content.style.display === "block") {
content.style.display = "none";
} else {
content.style.display = "block";
}
});
}
</script>
<h1 id="look-at-some-of-the-data">Look At Some Of The Data</h1>
<pre class='stata'>. list in 1/10 // list first 10 observations

     ┌───────────────────────────────────┐
     │ id        age   happy   somethi~e │
     ├───────────────────────────────────┤
  1. │  1        200       5   -.2740025 │
  2. │  2   41.74908       1    .3407284 │
  3. │  3   48.99197       1    1.097281 │
  4. │  4   41.29318       2      .99441 │
  5. │  5   38.30437       1   -.9095201 │
     ├───────────────────────────────────┤
  6. │  6   65.80429       3   -.6050416 │
  7. │  7   44.24375       2    .0133314 │
  8. │  8   52.14927       5    .4847669 │
  9. │  9    54.0201       5   -.9933645 │
 10. │ 10     67.752     999    .5900007 │
     └───────────────────────────────────┘
</pre>
<h1 id="clean-the-data">Clean The Data!</h1>
<h2 id="look-at-the-data-and-think-about-the-data-describe-summarize-tabulate-codebook">Look at The Data and Think About The Data (<code>describe</code>, <code>summarize</code>, <code>tabulate</code>, <code>codebook</code>)</h2>
<blockquote>
<p>When we look at variables we are looking for values that don't make sense, or that are outside the plausible range. As we are working with the data, it may sometimes be helpful to <code>browse</code> the data.</p>
</blockquote>
<pre class='stata'>. describe // describe the data

Contains data
 Observations:           100                  
    Variables:             4                  
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Variable      Storage   Display    Value
    name         type    format    label      Variable label
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
id              float   %9.0g                 
age             float   %9.0g                 
happy           float   %9.0g                 
somethingelse   float   %9.0g                 
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Sorted by: 
     Note: Dataset has changed since last saved.
</pre>
<pre class='stata'>. summarize // descriptive statistics

    Variable │        Obs        Mean    Std. dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          id │        100        50.5    29.01149          1        100
         age │        100    51.58624    18.05763    24.2431        200
       happy │        100       12.94    99.61267          1        999
somethinge~e │        100   -.0249813    1.009199  -2.277072   2.547337
</pre>
<pre class='stata'>. tabulate happy // tabulation of this particular categorical variable

      happy │      Freq.     Percent        Cum.
────────────┼───────────────────────────────────
          1 │         20       20.00       20.00
          2 │         24       24.00       44.00
          3 │         15       15.00       59.00
          4 │         18       18.00       77.00
          5 │         22       22.00       99.00
        999 │          1        1.00      100.00
────────────┼───────────────────────────────────
      Total │        100      100.00
</pre>
<pre class='stata'>. codebook happy // VERY detailed view of this particular categorical variable

────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
happy                                                                                                                                (unlabeled)
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

                  Type: Numeric (float)

                 Range: [1,999]                       Units: 1
         Unique values: 6                         Missing .: 0/100

            Tabulation: Freq.  Value
                           20  1
                           24  2
                           15  3
                           18  4
                           22  5
                            1  999
</pre>
<p>Notice that...</p>
<ul>
<li>There are variables in which we may not have interest.</li>
<li>None of the variables are labelled informatively.</li>
<li>Variables do not seem to have informative value labels.</li>
<li>Someone appears to 200 years old.</li>
<li>There appear to be missing values in the variable <code>happy</code> that need to be recoded.</li>
</ul>
<blockquote>
<p>Remember that the command <code>lookfor</code> is often very helpful in <em>looking for</em> a particular variable. e.g. <code>lookfor happy</code>.</p>
</blockquote>
<h2 id="only-keep-the-variables-of-interest">Only <code>keep</code> The Variables Of Interest</h2>
<p>We may only be interested in keeping some variables to keep our analytic data set more manageable.</p>
<p>For this particular analysis we may wish to drop the variable called <code>somethingelse</code>.</p>
<pre class='stata'>. keep id age happy // keep only relevant variables
</pre>
<p>We could also have said <code>drop somethingelse</code>.</p>
<h2 id="add-variable-labels-label-variable-...">Add <em>Variable</em> Labels (<code>label variable &quot;...&quot;</code>)</h2>
<pre class='stata'>. label variable id "ID" // label variable
</pre>
<pre class='stata'>. label variable age "Age in Years" // label variable
</pre>
<pre class='stata'>. label variable happy "Happiness Scale" // label variable
</pre>
<h2 id="create-value-labels-label-define-...">Create <em>Value</em> Labels (<code>label define ...</code>)</h2>
<pre class='stata'>. label define happy 1 "Rarely" 2 "Sometimes" 3 "Often" 4 "Always" // create value label
</pre>
<h2 id="attach-value-labels-to-variables-label-values-...">Attach <em>Value</em> Labels To <em>Variables</em> (<code>label values ...</code>)</h2>
<p><em>Variables</em> and <em>value labels</em> can have the same names but are different things. We add the variable label <code>happy</code> to the variable named <code>happy</code>.</p>
<pre class='stata'>. label values happy happy // attach VALUE LABEL happy to VARIABLE happy
</pre>
<h2 id="recode-outliers-values-that-are-errors-or-values-that-should-be-coded-as-missing-recode">Recode Outliers, Values That Are Errors, Or Values That Should Be Coded As Missing (<code>recode</code>)</h2>
<pre class='stata'>. recode happy (999 = .) // recode values as missing
(1 changes made to happy)
</pre>
<pre class='stata'>. recode age (100/max = 100) // age is topcoded at 100 (may or may not be plausible)
(1 changes made to age)
</pre>
<h1 id="we-describe-and-summarize-the-data-and-see-the-changes-that-have-been-made">We <code>describe</code> and <code>summarize</code> The Data And See The Changes That Have Been Made</h1>
<pre class='stata'>. describe

Contains data
 Observations:           100                  
    Variables:             3                  
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Variable      Storage   Display    Value
    name         type    format    label      Variable label
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
id              float   %9.0g                 ID
age             float   %9.0g                 Age in Years
happy           float   %9.0g      happy      Happiness Scale
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Sorted by: 
     Note: Dataset has changed since last saved.
</pre>
<pre class='stata'>. summarize

    Variable │        Obs        Mean    Std. dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          id │        100        50.5    29.01149          1        100
         age │        100    50.58624     11.2362    24.2431        100
       happy │         99    2.979798    1.463709          1          5
</pre>
</body>
</html>
